<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cricket Rewards</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Monetag -->
<script src="https://libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

<style>
:root{
  --bg:#050814;
  --card:rgba(255,255,255,.08);
  --cyan:#00eaff;
  --gold:#ffcc00;
  --green:#00ff99;
  --red:#ff4d4d;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui;
  background:radial-gradient(circle at top,#0b1020,#050814);
  color:#fff;
}

.app{padding:16px;max-width:520px;margin:auto}

/* ---------- HEADER ---------- */
.header{
  display:flex;justify-content:space-between;align-items:center;
  margin-bottom:12px
}
.user{
  font-size:13px;opacity:.9
}
.badge{
  background:rgba(0,234,255,.15);
  padding:2px 8px;border-radius:20px;
  font-size:11px;color:var(--cyan)
}

/* ---------- CARDS ---------- */
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  margin-bottom:14px;
  box-shadow:0 0 25px rgba(0,0,0,.4);
  animation:fadeUp .5s ease
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:none}
}

/* ---------- PROGRESS ---------- */
.progress-wrap{
  display:flex;justify-content:center;margin:10px 0
}
.progress-ring{
  --p:0;
  width:170px;height:170px;border-radius:50%;
  background:conic-gradient(var(--cyan) calc(var(--p)*1%), #1e293b 0);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 30px rgba(0,234,255,.45)
}
.progress-inner{
  width:130px;height:130px;border-radius:50%;
  background:#020617;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  text-align:center
}
.progress-inner b{font-size:26px}
.progress-inner span{font-size:12px;opacity:.7}

/* ---------- BUTTONS ---------- */
.btn{
  width:100%;padding:14px;
  border:none;border-radius:14px;
  font-size:16px;color:#fff;
  cursor:pointer;margin-top:10px
}
.btn:active{transform:scale(.97)}
.btn:disabled{opacity:.5}

.btn-earn{
  background:linear-gradient(135deg,#00c6ff,#0072ff)
}
.btn-quick{
  background:linear-gradient(135deg,#ffb347,#ff7f50)
}
.btn-join{
  background:linear-gradient(135deg,#00ff99,#00c853)
}
.btn-locked{
  background:linear-gradient(135deg,#576574,#2c2c54)
}

/* ---------- MATCH ---------- */
.match{
  padding:14px;border-radius:14px;
  border:1px solid rgba(255,255,255,.1);
  margin-bottom:10px
}
.match.locked{opacity:.55;filter:blur(.7px)}
.live-dot{
  width:10px;height:10px;border-radius:50%;
  background:red;animation:pulse 1s infinite
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(255,0,0,.6)}
  100%{box-shadow:0 0 0 10px rgba(255,0,0,0)}
}

/* ---------- TUTORIAL ---------- */
.overlay{
  position:fixed;inset:0;
  background:rgba(5,8,20,.96);
  display:flex;align-items:center;justify-content:center;
  z-index:99;padding:20px
}
.tutorial{
  max-width:360px;text-align:center
}
.tutorial h2{margin-bottom:8px}
.step{margin:14px 0;opacity:.9}
.step b{color:var(--cyan)}

.footer-note{
  font-size:12px;text-align:center;opacity:.6;margin-top:10px
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <h3>üèè Cricket Rewards</h3>
  <div class="user">
    <div id="uname">@user</div>
    <div class="badge">ID <span id="uid">0000</span></div>
  </div>
</div>

<!-- PROGRESS -->
<div class="card">
  <h4>üéÆ Your Progress</h4>
  <div class="progress-wrap">
    <div class="progress-ring" id="ring">
      <div class="progress-inner">
        <b><span id="mins">0</span>/15</b>
        <span>Minutes</span>
      </div>
    </div>
  </div>
  <div style="text-align:center;font-size:14px" id="statusText">
    Earn 15 minutes to unlock LIVE matches
  </div>
</div>

<!-- EARN -->
<div class="card">
  <h4>üí∞ Earn Minutes</h4>
  <button class="btn btn-earn" onclick="watchReward()">üé¨ Watch Ad (+2 min)</button>
  <button class="btn btn-quick" onclick="watchQuick()">‚ö° Quick Ad (+1 min)</button>
</div>

<!-- MATCHES -->
<div class="card">
  <h4>üî¥ LIVE MATCHES</h4>

  <div class="match" id="match1">
    <div style="display:flex;justify-content:space-between">
      <b>Bangladesh Premier League</b>
      <div class="live-dot"></div>
    </div>
    <button class="btn btn-join" id="btn1" onclick="join('match1')">JOIN</button>
  </div>

  <div class="match" id="match2">
    <div style="display:flex;justify-content:space-between">
      <b>Big Bash League</b>
      <div class="live-dot"></div>
    </div>
    <button class="btn btn-join" id="btn2" onclick="join('match2')">JOIN</button>
  </div>
</div>

<div class="footer-note">
  Minutes reduce while watching. Close app after joining.
</div>
</div>

<!-- TUTORIAL -->
<div class="overlay" id="tutorial">
  <div class="tutorial">
    <h2>Welcome üëã</h2>
    <div class="step">1Ô∏è‚É£ <b>Watch Ads</b> to earn minutes</div>
    <div class="step">2Ô∏è‚É£ Reach <b>15 Minutes</b></div>
    <div class="step">3Ô∏è‚É£ Unlock & join <b>LIVE Cricket</b></div>
    <button class="btn btn-join" onclick="start()">START EARNING</button>
  </div>
</div>

<script>
/* ---------- TELEGRAM ---------- */
const tg = Telegram.WebApp;
tg.ready();
const user = tg.initDataUnsafe.user;

/* ---------- UI USER ---------- */
uname.innerText = '@' + (user.username || 'player');
uid.innerText = String(user.id).slice(-4);

/* ---------- FIREBASE ---------- */
firebase.initializeApp({
  apiKey: "AIzaSyBhwMJdFGmbxE8nAVKPyRJJzuHn6xmyI7Q",
  databaseURL: "https://cricketteligram-default-rtdb.firebaseio.com"
});
const ref = firebase.database().ref('users/' + user.id);

/* ---------- INIT ---------- */
ref.once('value').then(s=>{
  if(!s.exists()){
    ref.set({
      totalMinutes:0,
      tutorialSeen:false
    })
  }
});

/* ---------- LISTENER ---------- */
ref.on('value',s=>{
  const d=s.val(); if(!d)return;
  mins.innerText=d.totalMinutes;
  ring.style.setProperty('--p',Math.min(100,(d.totalMinutes/15)*100));

  const unlocked=d.totalMinutes>=15;
  statusText.innerText=unlocked?'üîì Matches Unlocked':'üîí Earn 15 minutes';

  ['match1','match2'].forEach((m,i)=>{
    const box=document.getElementById(m);
    const btn=document.getElementById('btn'+(i+1));
    if(unlocked){
      box.classList.remove('locked');
      btn.disabled=false;
      btn.innerText='JOIN';
      btn.className='btn btn-join';
    }else{
      box.classList.add('locked');
      btn.disabled=true;
      btn.innerText='LOCKED';
      btn.className='btn btn-locked';
    }
  });

  if(d.tutorialSeen) tutorial.style.display='none';
});

/* ---------- TUTORIAL ---------- */
function start(){
  ref.update({tutorialSeen:true});
  tutorial.style.display='none';
}

/* ---------- REWARD ---------- */
function reward(m){
  ref.transaction(d=>{
    if(!d)return d;
    d.totalMinutes+=m;
    return d;
  })
}

async function watchReward(){
  await show_10340427();
  reward(2);
}

async function watchQuick(){
  await show_10340427('pop');
  reward(1);
}

/* ---------- JOIN ---------- */
async function join(channel){
  fetch('https://ancient-shadow-773c.samaraedirisooriya123.workers.dev/api/generate-invite',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({userId:String(user.id),channelId:channel})
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.inviteLink) window.open(d.inviteLink,'_blank');
  })
}
</script>
</body>
</html>
