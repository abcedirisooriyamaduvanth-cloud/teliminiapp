<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cricket Rewards</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Monetag -->
<script src="//libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: linear-gradient(180deg,#0b1020,#050814);
  color: #fff;
}

.app {
  padding: 16px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.card {
  background: rgba(255,255,255,0.08);
  border-radius: 16px;
  padding: 16px;
  margin-top: 14px;
  animation: fadeUp .5s ease;
}

.btn {
  width: 100%;
  padding: 14px;
  margin-top: 10px;
  background: linear-gradient(135deg,#00c6ff,#0072ff);
  border: none;
  border-radius: 12px;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
}

.btn:active {
  transform: scale(0.97);
}

.loader {
  display: none;
  text-align: center;
  margin-top: 10px;
}

@keyframes fadeUp {
  from {opacity:0; transform:translateY(20px)}
  to {opacity:1; transform:translateY(0)}
}
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <h3>ğŸ Cricket Rewards</h3>
    <span id="username"></span>
  </div>

  <div class="card">
    <h4>Total Earned</h4>
    <p>â± Minutes: <b id="minutes">0</b></p>
    <p>ğŸ’° Earnings: $<b id="earnings">0.00</b></p>
  </div>

  <div class="card">
    <h4>Earn Minutes</h4>

    <button class="btn" onclick="watchRewarded()">ğŸ¬ Watch Ad ( +2 min )</button>
    <button class="btn" onclick="watchPopup()">ğŸ”¥ Popup Ad ( +1 min )</button>

    <div class="loader" id="loader">Loading Ad...</div>
  </div>

</div>

<script>
/* ---------------- TELEGRAM USER ---------------- */
const tg = Telegram.WebApp;
tg.ready();

const user = tg.initDataUnsafe.user;
document.getElementById("username").innerText = "@" + (user.username || "player");

/* ---------------- FIREBASE ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyBhwMJdFGmbxE8nAVKPyRJJzuHn6xmyI7Q",
  authDomain: "cricketteligram.firebaseapp.com",
  databaseURL: "https://cricketteligram-default-rtdb.firebaseio.com",
  projectId: "cricketteligram"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const userRef = db.ref("users/" + user.id);

/* ---------------- INIT USER ---------------- */
userRef.once("value").then(snap => {
  if (!snap.exists()) {
    userRef.set({
      uid: user.id,
      username: user.username || "",
      name: user.first_name || "",
      totalMinutes: 0,
      totalEarnings: 0,
      adViews: 0,
      lastEarnedAt: Date.now()
    });
  }
});

userRef.on("value", snap => {
  const d = snap.val();
  document.getElementById("minutes").innerText = d.totalMinutes;
  document.getElementById("earnings").innerText = d.totalEarnings.toFixed(2);
});

/* ---------------- REWARD LOGIC ---------------- */
function reward(minutes) {
  userRef.transaction(d => {
    if (!d) return d;
    d.totalMinutes += minutes;
    d.adViews += 1;
    d.totalEarnings += minutes * 0.02; // example
    d.lastEarnedAt = Date.now();
    return d;
  });
}

/* ---------------- ADS ---------------- */
function watchRewarded() {
  loader(true);
  show_10340427().then(() => {
    reward(2);
    alert("ğŸ‰ You earned 2 minutes!");
  }).finally(() => loader(false));
}

function watchPopup() {
  loader(true);
  show_10340427('pop').then(() => {
    reward(1);
    alert("ğŸ”¥ You earned 1 minute!");
  }).finally(() => loader(false));
}

function loader(show) {
  document.getElementById("loader").style.display = show ? "block" : "none";
}
</script>

</body>
</html>
