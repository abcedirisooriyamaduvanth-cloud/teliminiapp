<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üèè CricketStream Pro</title>

<!-- MONETAG -->
<script src="//libtl.com/sdk.js"
  data-zone="10340427"
  data-sdk="show_10340427"></script>

<!-- TELEGRAM -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#052e16;
  color:#fff;
}
.hidden { display:none; }

header {
  padding:14px;
  text-align:center;
  font-weight:700;
  background:#0008;
}

.section {
  margin:14px;
  padding:14px;
  background:#ffffff12;
  border-radius:12px;
}

button {
  background:#22c55e;
  border:none;
  padding:12px 16px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}

.loading {
  position:fixed;
  inset:0;
  background:#000d;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:999;
}
.loading.show { display:flex; }

.spinner {
  width:40px;
  height:40px;
  border:4px solid #ffffff33;
  border-top-color:#22c55e;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:12px;
}
@keyframes spin { to { transform:rotate(360deg); } }

.ad {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:10px;
  background:#0006;
  padding:12px;
  border-radius:10px;
}

iframe {
  width:100%;
  height:100vh;
  border:none;
}
</style>
</head>

<body>

<header>üèè CricketStream Pro</header>

<!-- LOADING -->
<div id="loading" class="loading">
  <div class="spinner"></div>
  <div id="loadingText">Loading‚Ä¶</div>
</div>

<!-- LOGIN -->
<div id="login" class="section">
  <p>Login to continue</p>
  <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="section">
    <b>User:</b> <span id="userName"></span><br>
    <b>Minutes:</b> <span id="minutes">0</span>
  </div>

  <div class="section">
    <h3>üéØ Earn Minutes</h3>
    <div class="ad">
      <div>
        <b>Rewarded Ad</b><br>
        +3 minutes
      </div>
      <button onclick="watchAd()">Watch</button>
    </div>
  </div>

  <div class="section">
    <h3>üì∫ Watch Stream</h3>
    <input id="streamUrl"
      placeholder="Paste stream URL"
      style="width:100%;padding:10px;border-radius:8px;border:none">
    <button style="margin-top:10px" onclick="openStream()">Open Stream</button>
  </div>

</div>

<!-- STREAM -->
<div id="viewer" class="hidden">
  <button onclick="closeStream()" style="margin:10px">‚¨Ö Back</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* ========= STATE ========= */
let user = null;
let minutes = 0;
let lastAd = 0;
const COOLDOWN = 6 * 60 * 1000;

/* ========= UI ========= */
const loading = document.getElementById('loading');
const loadingText = document.getElementById('loadingText');

function showLoading(text) {
  loadingText.innerText = text;
  loading.classList.add('show');
}
function hideLoading() {
  loading.classList.remove('show');
}

/* ========= AUTH ========= */
function login() {
  showLoading("Authenticating‚Ä¶");

  setTimeout(() => {
    const tg = window.Telegram?.WebApp;
    tg?.ready();

    if (tg?.initDataUnsafe?.user) {
      user = tg.initDataUnsafe.user;
    } else {
      // Browser fallback (TEST MODE)
      user = { username: "TestUser" };
    }

    document.getElementById('userName').innerText =
      user.username || "User";

    document.getElementById('login').classList.add('hidden');
    document.getElementById('dashboard').classList.remove('hidden');

    hideLoading();
  }, 800);
}

/* ========= EARN ========= */
function watchAd() {
  if (Date.now() - lastAd < COOLDOWN) {
    alert("Ad cooldown active");
    return;
  }

  if (typeof show_10340427 !== 'function') {
    alert("Ad system not ready");
    return;
  }

  showLoading("Loading advertisement‚Ä¶");
  show_10340427();

  setTimeout(() => {
    hideLoading();
    minutes += 3;
    lastAd = Date.now();
    document.getElementById('minutes').innerText = minutes;
    alert("+3 minutes earned");
  }, 7000);
}

/* ========= STREAM ========= */
function openStream() {
  if (minutes < 3) {
    alert("Earn minutes first");
    return;
  }

  const url = document.getElementById('streamUrl').value;
  if (!url) {
    alert("Add stream URL");
    return;
  }

  minutes -= 3;
  document.getElementById('minutes').innerText = minutes;

  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('viewer').classList.remove('hidden');
  document.getElementById('frame').src = url;
}

function closeStream() {
  document.getElementById('viewer').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('frame').src = '';
}
</script>

</body>
</html>
