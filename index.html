<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cricket Live Rewards</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Monetag -->
<script src="https://libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:radial-gradient(circle at top,#2a0000,#070000);
  color:#fff;
}
.app{padding:16px;max-width:520px;margin:auto;}
.header{
  display:flex;justify-content:space-between;align-items:center;
}
.header h3{
  font-family:'Orbitron';
  color:#ffb703;
  text-shadow:0 0 12px #ff4500;
}
.card{
  background:linear-gradient(180deg,rgba(255,80,0,.18),rgba(0,0,0,.45));
  border-radius:18px;
  padding:16px;
  margin-top:14px;
  box-shadow:0 0 22px rgba(255,69,0,.25);
}
.btn{
  width:100%;
  padding:14px;
  margin-top:10px;
  background:linear-gradient(135deg,#ff512f,#f09819);
  border:none;
  border-radius:16px;
  color:#fff;
  font-size:16px;
  font-weight:bold;
  cursor:pointer;
}
.btn:disabled{opacity:.45}
.status-dot{
  width:12px;height:12px;border-radius:50%;
  box-shadow:0 0 12px currentColor;
}
.progress{
  height:12px;border-radius:10px;
  background:rgba(255,255,255,.15);
  overflow:hidden;margin-top:8px;
}
.progress > div{
  height:100%;width:0%;
  background:linear-gradient(90deg,#ff512f,#ffe259);
  transition:.4s;
}
.unlock{animation:pulse 1s infinite;}
@keyframes pulse{
  0%{box-shadow:0 0 10px #ff9800}
  50%{box-shadow:0 0 25px #ff4500}
  100%{box-shadow:0 0 10px #ff9800}
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <h3>ğŸ”¥ CRICKET LIVE</h3>
  <small id="username"></small>
</div>

<!-- STATS -->
<div class="card">
  <h4>â± Your Minutes</h4>
  <b id="minutes">0</b> minutes
  <div class="progress"><div id="progress"></div></div>
</div>

<!-- EARN -->
<div class="card">
  <h4>âš¡ Earn Minutes</h4>
  <button class="btn" onclick="watchRewarded()">ğŸ¬ Watch Ad (+2 min)</button>
  <button class="btn" onclick="watchPopup()">ğŸ”¥ Popup Ad (+1 min)</button>
  <div id="loader" style="display:none;margin-top:8px">Loading adâ€¦</div>
</div>

<!-- MATCH 1 -->
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h4>ğŸ Bangladesh Premier League</h4>
    <span id="status-match1" class="status-dot"></span>
  </div>
  <p id="req-match1">Need 15 minutes</p>
  <button class="btn" id="btn-match1" onclick="joinChannel('match1')">LOCKED</button>
</div>

<!-- MATCH 2 -->
<div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h4>ğŸ Big Bash League</h4>
    <span id="status-match2" class="status-dot"></span>
  </div>
  <p id="req-match2">Need 15 minutes</p>
  <button class="btn" id="btn-match2" onclick="joinChannel('match2')">LOCKED</button>
</div>

</div>

<script>
/* TELEGRAM */
const tg=Telegram.WebApp;tg.ready();
const user=tg.initDataUnsafe.user;
document.getElementById("username").innerText="@"+(user?.username||"player");

/* FIREBASE */
firebase.initializeApp({
 apiKey:"AIzaSyBhwMJdFGmbxE8nAVKPyRJJzuHn6xmyI7Q",
 databaseURL:"https://cricketteligram-default-rtdb.firebaseio.com"
});
const db=firebase.database();
const userRef=db.ref("users/"+user.id);

/* INIT */
userRef.once("value").then(s=>{
 if(!s.exists()){
  userRef.set({
   uid:user.id,
   username:user.username||"",
   totalMinutes:0,
   totalEarnings:0,
   adViews:0,
   joinedChannels:{}
  });
 }
});

/* REALTIME â€“ SAME LOGIC */
userRef.on("value",snap=>{
 const d=snap.val(); if(!d) return;
 const m=d.totalMinutes||0;

 document.getElementById("minutes").innerText=m;
 document.getElementById("progress").style.width=Math.min(m/15*100,100)+"%";

 ["match1","match2"].forEach(ch=>{
  const btn=document.getElementById("btn-"+ch);
  const txt=document.getElementById("req-"+ch);
  const st=document.getElementById("status-"+ch);

  if(m>=15){
   btn.disabled=false;
   btn.textContent="JOIN LIVE";
   btn.classList.add("unlock");
   txt.textContent="UNLOCKED â€“ JOIN NOW";
   st.style.background="#00ff00";
  }else{
   btn.disabled=true;
   btn.textContent="LOCKED";
   btn.classList.remove("unlock");
   txt.textContent=`Need ${15-m} more minutes`;
   st.style.background="#ffaa00";
  }
 });
});

/* ADS â€“ SAME */
function loader(v){document.getElementById("loader").style.display=v?"block":"none";}

async function watchRewarded(){
 loader(true);
 await show_10340427();
 userRef.transaction(d=>{
  d.totalMinutes+=2;
  d.totalEarnings+=0.04;
  d.adViews+=1;
  return d;
 });
 loader(false);
}

async function watchPopup(){
 loader(true);
 await show_10340427('pop');
 userRef.transaction(d=>{
  d.totalMinutes+=1;
  d.totalEarnings+=0.02;
  d.adViews+=1;
  return d;
 });
 loader(false);
}

/* JOIN â€“ SAME WORKER */
async function joinChannel(channelId){
 const r=await fetch("https://ancient-shadow-773c.samaraedirisooriya123.workers.dev/api/generate-invite",{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({userId:String(user.id),channelId})
 });
 const d=await r.json();
 if(d.inviteLink) window.open(d.inviteLink,"_blank");
}
</script>
</body>
</html>
