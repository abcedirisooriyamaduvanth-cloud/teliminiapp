<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèè CricketStream Pro</title>

<!-- MONETAG SDK -->
<script src="//libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

<!-- TELEGRAM SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin:0;
  font-family: system-ui, sans-serif;
  background:#062e16;
  color:#fff;
}
.hidden { display:none; }

header {
  padding:14px;
  background:#0008;
  text-align:center;
  font-weight:700;
}

.section {
  margin:14px;
  padding:14px;
  background:#ffffff10;
  border-radius:12px;
}

button {
  background:#22c55e;
  border:none;
  padding:12px 16px;
  border-radius:10px;
  font-weight:600;
}

.ad {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-top:10px;
  background:#0006;
  padding:12px;
  border-radius:10px;
}

.loading {
  position:fixed;
  inset:0;
  background:#000d;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:999;
}
.loading.show { display:flex; }

iframe {
  width:100%;
  height:100vh;
  border:none;
}
</style>
</head>

<body>

<header>üèè CricketStream Pro</header>

<!-- LOGIN -->
<div id="login" class="section">
  <p>Login required to continue</p>
  <button onclick="login()">Login with Telegram</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="section">
    <b>User:</b> <span id="user"></span><br>
    <b>Minutes:</b> <span id="minutes">0</span>
  </div>

  <!-- EARN WAYS -->
  <div class="section">
    <h3>üéØ Earn Minutes</h3>

    <div class="ad">
      <div>
        <b>Rewarded Video</b><br>
        +3 minutes
      </div>
      <button onclick="watchAd()">Watch</button>
    </div>
  </div>

  <!-- STREAM -->
  <div class="section">
    <h3>üì∫ Watch Stream</h3>
    <input id="streamUrl" placeholder="Paste stream URL"
      style="width:100%;padding:10px;border-radius:8px;border:none">
    <button style="margin-top:10px" onclick="openStream()">Open Stream</button>
  </div>

</div>

<!-- LOADING -->
<div id="loading" class="loading">
  <p>Loading Ad‚Ä¶</p>
</div>

<!-- STREAM VIEW -->
<div id="viewer" class="hidden">
  <button onclick="closeStream()" style="margin:10px">‚¨Ö Back</button>
  <iframe id="frame"></iframe>
</div>

<script>
/* =====================
   GLOBAL STATE
===================== */
let tgUser = null;
let minutes = 0;
let lastAdTime = 0;
const COOLDOWN = 6 * 60 * 1000; // 6 minutes

/* =====================
   AUTH
===================== */
function login() {
  const tg = window.Telegram.WebApp;
  tg.ready();

  if (!tg.initDataUnsafe.user) {
    alert("Open inside Telegram");
    return;
  }

  tgUser = tg.initDataUnsafe.user;
  document.getElementById('user').innerText =
    tgUser.username || tgUser.first_name;

  document.getElementById('login').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
}

/* =====================
   EARN LOGIC
===================== */
function watchAd() {
  const now = Date.now();
  if (now - lastAdTime < COOLDOWN) {
    alert("Ad cooldown active");
    return;
  }

  if (typeof show_10340427 !== 'function') {
    alert("Ad not ready");
    return;
  }

  document.getElementById('loading').classList.add('show');

  show_10340427(); // Monetag call

  // SAFE reward fallback
  setTimeout(() => {
    document.getElementById('loading').classList.remove('show');
    minutes += 3;
    lastAdTime = Date.now();
    document.getElementById('minutes').innerText = minutes;
    alert("+3 minutes added");
  }, 7000);
}

/* =====================
   STREAM LOGIC
===================== */
function openStream() {
  if (minutes < 3) {
    alert("Earn minutes first");
    return;
  }

  const url = document.getElementById('streamUrl').value;
  if (!url) {
    alert("Add stream URL");
    return;
  }

  minutes -= 3;
  document.getElementById('minutes').innerText = minutes;

  document.getElementById('dashboard').classList.add('hidden');
  document.getElementById('viewer').classList.remove('hidden');
  document.getElementById('frame').src = url;
}

function closeStream() {
  document.getElementById('viewer').classList.add('hidden');
  document.getElementById('dashboard').classList.remove('hidden');
  document.getElementById('frame').src = '';
}
</script>

</body>
</html>
