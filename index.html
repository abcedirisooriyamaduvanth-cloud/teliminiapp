<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Cricket Franchise Rewards</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- Telegram -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Monetag -->
<script src="https://libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: radial-gradient(circle at top, #2b0000, #050000);
  color: #fff;
}

.app {
  padding: 16px;
  max-width: 520px;
  margin: auto;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.header h3 {
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1px;
  color: #ffb703;
  text-shadow: 0 0 12px #ff4500;
}

.card {
  background: linear-gradient(180deg, rgba(255,80,0,0.18), rgba(255,255,255,0.04));
  border-radius: 18px;
  padding: 16px;
  margin-top: 14px;
  box-shadow: 0 0 25px rgba(255,69,0,.25);
  animation: fadeUp .6s ease;
}

/* STEPS */
.step {
  display: flex;
  gap: 10px;
  align-items: center;
  margin-bottom: 10px;
}
.step span {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: linear-gradient(135deg,#ff512f,#dd2476);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
}

/* BUTTONS */
.btn {
  width: 100%;
  padding: 15px;
  margin-top: 10px;
  background: linear-gradient(135deg,#ff512f,#f09819);
  border: none;
  border-radius: 16px;
  color: #fff;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 18px rgba(255,120,0,.7);
  transition: .15s;
  position: relative;
  overflow: hidden;
}

.btn:active { transform: scale(.95); }
.btn:disabled { opacity: .45; box-shadow:none; }

/* FLOATING +MIN */
.float {
  position: absolute;
  animation: floatUp 1s ease forwards;
  font-weight: bold;
  pointer-events: none;
}

@keyframes floatUp {
  from { opacity:1; transform:translateY(0); }
  to { opacity:0; transform:translateY(-40px); }
}

/* PROGRESS */
.progress-bar {
  width: 100%;
  height: 14px;
  border-radius: 20px;
  background: rgba(255,255,255,.1);
  overflow: hidden;
  margin-top: 8px;
}
.progress {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg,#ff512f,#f09819,#ffe259);
  transition: width .4s ease;
  box-shadow: 0 0 12px #ff9800;
}

/* CHANNEL */
.channel-card {
  background: linear-gradient(145deg, rgba(255,90,0,.25), rgba(0,0,0,.4));
  border-radius: 16px;
  padding: 14px;
  margin-bottom: 14px;
  border: 1px solid rgba(255,140,0,.35);
}

.unlock {
  animation: unlockPulse 1s infinite;
}

@keyframes unlockPulse {
  0% { box-shadow: 0 0 10px #ff9800; }
  50% { box-shadow: 0 0 28px #ff4500; }
  100% { box-shadow: 0 0 10px #ff9800; }
}

.status-indicator {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

@keyframes fadeUp {
  from { opacity:0; transform:translateY(25px); }
  to { opacity:1; transform:translateY(0); }
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="header">
  <h3>üî• CRICKET FRANCHISE</h3>
  <small id="username"></small>
</div>

<!-- HOW IT WORKS -->
<div class="card">
  <h4>üéÆ Game Rules</h4>
  <div class="step"><span>1</span> Watch ads ‚Üí earn unlimited minutes</div>
  <div class="step"><span>2</span> Reach <b>15 min</b> to unlock matches</div>
  <div class="step"><span>3</span> Join channel ‚Üí time starts reducing</div>
</div>

<!-- STATS -->
<div class="card">
  <h4>üî• Your Power</h4>
  <p>‚è± Minutes: <b id="minutes">0</b></p>
  <div class="progress-bar"><div class="progress" id="progress"></div></div>
</div>

<!-- EARN -->
<div class="card">
  <h4>‚ö° Earn Power</h4>
  <button class="btn" onclick="earn(this,2)">üé¨ Watch Ad (+2 min)</button>
  <button class="btn" onclick="earn(this,1)">üî• Popup Ad (+1 min)</button>
</div>

<!-- MATCH -->
<div class="card">
  <h4>üèè Live Match</h4>
  <div class="channel-card" id="matchCard">
    <div style="display:flex;justify-content:space-between">
      <b>Franchise League Live</b>
      <span id="status-match1" class="status-indicator"></span>
    </div>
    <p id="req-match1">Need 15 minutes</p>
    <button class="btn" id="btn-match1" onclick="joinChannel('match1')">üîí LOCKED</button>
  </div>
</div>

</div>

<script>
/* TELEGRAM */
const tg = Telegram.WebApp; tg.ready();
const user = tg.initDataUnsafe.user;
document.getElementById("username").innerText = "@"+(user?.username||"player");

/* FIREBASE */
firebase.initializeApp({
  apiKey:"AIzaSyBhwMJdFGmbxE8nAVKPyRJJzuHn6xmyI7Q",
  databaseURL:"https://cricketteligram-default-rtdb.firebaseio.com"
});
const db=firebase.database();
const userRef=db.ref("users/"+user.id);

/* INIT */
userRef.once("value").then(s=>{
 if(!s.exists()) userRef.set({uid:user.id,totalMinutes:0,joinedChannels:{}});
});

/* REALTIME */
userRef.on("value",s=>{
 const d=s.val(); if(!d) return;
 const m=d.totalMinutes||0;
 document.getElementById("minutes").innerText=m;
 document.getElementById("progress").style.width=Math.min(m/15*100,100)+"%";

 const btn=document.getElementById("btn-match1");
 const req=document.getElementById("req-match1");
 const card=document.getElementById("matchCard");
 const st=document.getElementById("status-match1");

 if(m>=15){
   btn.disabled=false;
   btn.innerText="üî• JOIN MATCH";
   btn.classList.add("unlock");
   req.innerText="UNLOCKED!";
   st.style.background="#00ff00";
 } else {
   btn.disabled=true;
   btn.innerText="üîí LOCKED";
   req.innerText=`Need ${15-m} more minutes`;
   st.style.background="#ffaa00";
 }
});

/* EARN */
function earn(btn,min){
 showFloat(btn,"+"+min+"m");
 userRef.transaction(d=>{d.totalMinutes+=min;return d;});
}

/* FLOAT */
function showFloat(btn,text){
 const f=document.createElement("div");
 f.className="float";
 f.style.left="50%";
 f.style.top="10px";
 f.innerText=text;
 btn.appendChild(f);
 setTimeout(()=>f.remove(),1000);
}

/* JOIN */
async function joinChannel(id){
 await fetch("https://ancient-shadow-773c.samaraedirisooriya123.workers.dev/api/generate-invite",{
  method:"POST",
  headers:{'Content-Type':'application/json'},
  body:JSON.stringify({userId:String(user.id),channelId:id})
 }).then(r=>r.json()).then(d=>{
  if(d.inviteLink) window.open(d.inviteLink,"_blank");
 });
}
</script>
</body>
</html>
