<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>üèè CricketStream Pro</title>

  <!-- MONETAG SDK -->
  <script src="//libtl.com/sdk.js" data-zone="10340427" data-sdk="show_10340427"></script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Inter, system-ui, sans-serif;
      background: radial-gradient(circle at top, #14532d, #052e16);
      color: #fff;
      min-height: 100vh;
    }

    button {
      border: none;
      cursor: pointer;
      font-weight: 600;
    }

    .screen { display: none; padding: 20px; }
    .screen.active { display: block; }

    /* LOGIN */
    .login {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .login h1 { font-size: 3rem; margin-bottom: 10px; }
    .login p { opacity: .85; margin-bottom: 25px; }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #fff;
      padding: 14px 28px;
      border-radius: 12px;
      font-size: 1rem;
    }

    /* HEADER */
    .header {
      position: sticky;
      top: 0;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(12px);
      padding: 14px 20px;
      border-radius: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    /* STATS */
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
      margin-bottom: 20px;
    }
    .stat {
      background: rgba(255,255,255,.08);
      border-radius: 14px;
      padding: 16px;
      text-align: center;
    }
    .stat b { display: block; font-size: 1.8rem; color: #facc15; }

    /* SECTION */
    .section {
      background: rgba(255,255,255,.07);
      border-radius: 16px;
      padding: 18px;
      margin-bottom: 18px;
    }

    /* ADS */
    .ad-card {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(0,0,0,.35);
      border-radius: 14px;
      padding: 14px;
      margin-top: 12px;
    }
    .ad-card button {
      background: #22c55e;
      padding: 10px 16px;
      border-radius: 10px;
      color: #000;
    }

    /* LOADING */
    .loading {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 999;
      flex-direction: column;
    }
    .loading.show { display: flex; }

    .spinner {
      width: 52px;
      height: 52px;
      border: 4px solid rgba(255,255,255,.3);
      border-top-color: #22c55e;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 14px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* STREAM */
    .viewer {
      position: fixed;
      inset: 0;
      background: #000;
      display: none;
      z-index: 800;
    }
    .viewer.active { display: block; }
    .viewer iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
  </style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="screen login active">
  <div>
    <h1>üèè CricketStream Pro</h1>
    <p>Watch ads ‚Üí earn minutes ‚Üí watch cricket</p>
    <button class="btn-primary" onclick="login()">Login with Telegram</button>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="screen">
  <div class="header">
    <b>Dashboard</b>
    <span>üì± Telegram</span>
  </div>

  <div class="stats">
    <div class="stat"><b id="minutes">0</b>Minutes</div>
    <div class="stat"><b id="links">0</b>Links</div>
    <div class="stat"><b id="points">0</b>Points</div>
  </div>

  <div class="section">
    <h3>üéØ Earn Minutes</h3>
    <div class="ad-card" onclick="playAd()">
      <div>
        <b>Rewarded Video</b><br>
        <small>+3 minutes</small>
      </div>
      <button>Watch</button>
    </div>
  </div>

  <div class="section">
    <h3>üì∫ Watch Stream</h3>
    <input id="streamUrl"
      placeholder="Paste stream URL"
      style="width:100%;padding:12px;border-radius:10px;border:none" />
    <button class="btn-primary" style="margin-top:10px" onclick="openStream()">Open Stream</button>
  </div>
</div>

<!-- LOADING -->
<div id="loading" class="loading">
  <div class="spinner"></div>
  <p>Loading advertisement‚Ä¶</p>
</div>

<!-- STREAM VIEWER -->
<div id="viewer" class="viewer">
  <iframe id="frame"></iframe>
</div>

<script>
  const loginScreen = document.getElementById('login');
  const dashboard = document.getElementById('dashboard');
  const loading = document.getElementById('loading');
  const viewer = document.getElementById('viewer');
  const frame = document.getElementById('frame');

  let minutes = 0;

  function login() {
    loginScreen.classList.remove('active');
    dashboard.classList.add('active');
  }

  function playAd() {
    if (typeof show_10340427 !== 'function') {
      alert('Ad system not ready');
      return;
    }

    loading.classList.add('show');

    // Monetag does NOT return promise ‚Äì this is correct handling
    show_10340427();

    // Safe reward fallback
    setTimeout(() => {
      loading.classList.remove('show');
      minutes += 3;
      document.getElementById('minutes').innerText = minutes;
      document.getElementById('points').innerText = minutes;
      alert('+3 minutes earned');
    }, 7000);
  }

  function openStream() {
    const url = document.getElementById('streamUrl').value;
    if (!url) return alert('Add stream URL');
    viewer.classList.add('active');
    frame.src = url;
  }
</script>

</body>
</html>
